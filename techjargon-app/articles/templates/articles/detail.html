{% extends "_base.html" %} {% load static %} {% load article_meta_filter %} {% load humanize %} {% block title %} {{article.title}} |{% endblock %} {% block meta %}
<meta name="author" content="{{ article.active_content.author.user.first_name }} {{ article.active_content.author.user.last_name }}, TechJargon">
<meta name="article_keywords" content="{{ article.tags_str }}">

<meta name='twitter:card' content='summary_large_image' />
<meta name='twitter:image:src' content='http://fidenz.com/wp-content/themes/one-page/images/fidenz.png' />
<meta name='twitter:site' content='@techjargons' />
<meta name='twitter:url' content='{{ full_url_path }}' />
<meta name='twitter:description' content='{{ article.active_content.body }}' />
<meta name='twitter:title' content='{{ article.title }}' />

<!-- Open Graph Protocol Meta -->
<meta property='og:title' content='{{ article.title }}' />
<meta property="og:type" content="article" />
<meta property='og:url' content='{{ full_url_path }}' />
<meta property='og:image' content='http://fidenz.com/wp-content/themes/one-page/images/fidenz.png' />
<meta property='og:image:url' content='http://fidenz.com/wp-content/themes/one-page/images/fidenz.png' />
<meta property='og:image:width' content='1200' />
<meta property='og:image:height' content='630' />
<meta property='og:image:type' content='image/jpeg' />
<meta property='og:description' content='{{ article.active_content.body }}' />
<!-- END Open Graph Protocol Meta -->
{% endblock %} {% block content %}

<div class="row">
    <div class="col-md-3">
        <div class="sidebar-left article">
            <h1 class="article-title">{{ article.title }}</h1>
            <ul class="article-info">
                <li class="article-ratings readonly">
                    <!--<ul class="article-ratings">
						<li><i class="fa fa-star" aria-hidden="true"></i></li>
						<li><i class="fa fa-star" aria-hidden="true"></i></li>
						<li><i class="fa fa-star" aria-hidden="true"></i></li>
						<li><i class="fa fa-star" aria-hidden="true"></i></li>
					</ul>-->
                    <select id="articleRatings">
						<option value="1">1</option>
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
						<option value="5">5</option>
					</select>
                </li>
                <!--<li data-toggle="tooltip" title="Ratings"><i class="fa fa-star-o" aria-hidden="true"></i></span> 100</li>
				<li data-toggle="tooltip" title="Views"><i class="fa fa-eye" aria-hidden="true"></i> 210</li>-->
            </ul>
        </div>
    </div>
    <div class="col-md-6">
        <p class="article-content bottom-buffer-20" id="article-body">
            {{ article.active_content.body | safe }}
        </p>
        <!--<div class="pull-right"><span class="glyphicon glyphicon-list" aria-hidden="true"></span></div>-->
        <ul class="article-resources bottom-buffer-20">
            {% for meta in article.active_content.contentmeta_set.all %}
            <li>
                <span class="article-resources__label">{{ meta.name }}</span>{{ meta.data|article_meta|safe}}
            </li>
            {% endfor %}
        </ul>

        <ul class="article-tags bottom-buffer-20 clearfix">
            {% for tag in article.tags.all %}
            <li><a href="{% url 'articles:tags_detail' tag.slug %}">{{ tag.name }}</a></li>
            {% endfor %}
        </ul>

        <div class="clearfix">
            <ul class="article-author bottom-buffer-20">
                {% if article.content_set.count > 1 %}
                <li>
                    <div class="article-author__img" {% if article.active_content.author.profil_pic %} style="background-image: url('{{ article.active_content.author.profil_pic.url }}');" {% endif %}></div>
                    <div class="article-author__info">
                        <a href="">edited {{ article.active_content.created_at |  date:"d, N Y" }}</a>
                        <a href="">{{ article.active_content.author.user.first_name }} {{ article.active_content.author.user.last_name }}</a>
                    </div>
                </li>
                <li>
                    <div class="article-author__img" {% if article.history_content.author.profil_pic %} style="background-image: url('{{ article.history_content.author.profil_pic.url }}');" {% endif %}></div>
                    <div class="article-author__info">
                        <a href="">created {{ article.created_at |  date:"d, N Y" }}</a>
                        <a href="">{{ article.history_content.last.author.user.first_name }} {{ article.history_content.last.author.user.last_name }}</a>
                    </div>
                </li>
                {% else %}
                <li>
                    <div class="article-author__img" {% if article.active_content.author.profil_pic %} style="background-image: url('{{ article.active_content.author.profil_pic.url }}');" {% endif %}></div>
                    <div class="article-author__info">
                        <a href="">created {{ article.created_at |  date:"d, N Y" }}</a>
                        <a href="">{{ article.active_content.author.user.first_name }} {{ article.active_content.author.user.last_name }}</a>
                    </div>
                </li>
                {% endif %}
            </ul>
        </div>

        <ul class="article-actions bottom-buffer-40">
            <li>
                <a href="{% url 'articles:update' slug=article.slug article_id=article.id %}"><strong class="prominent">improve this article</strong></a>
            </li>
            <li>
                <a href="{% url 'articles:history' slug=article.slug content_id=article.active_content.id %}">history</a>
            </li>
        </ul>

        {% if user.is_authenticated %}
        <div class="article-signin article-ratings">
            <span class="article-signin__label" v-html="rating_feedback"></span>
            <select id="rateArticle" data-current-rating="@{ my_rating }" v-if="show_rating">
				<option value="1">1</option>
				<option value="2">2</option>
				<option value="3">3</option>
				<option value="4">4</option>
				<option value="5">5</option>
			</select>
        </div>
        {% else %}
        <div class="article-signin bottom-buffer-20">
            <a href="{% url 'authors:signin' %}"><strong>sign in</strong></a> to rate this article
        </div>
        {% endif %}




    </div>
    <div class="col-md-3">
        <ul class="article-info">
            <!--<li data-toggle="tooltip" title="Ratings"><i class="fa fa-star-o" aria-hidden="true"></i></span> 100</li>
            <li data-toggle="tooltip" title="Views"><i class="fa fa-eye" aria-hidden="true"></i> 210</li>-->
            <li data-toggle="tooltip" title="Ratings"><span class="article-ratings__label">ratings</span> {{ total_ratings | intcomma }}</li>
            <li data-toggle="tooltip" title="Views"><span class="article-ratings__label">views</span> {{ article.views | intcomma }}</li>
            <li data-toggle="tooltip" title="Views"><span class="article-ratings__label">updated</span> {{ article.active_content.updated_at | naturaltime }}</li>

        </ul>
        <ul class="no-ul sidebar-h2-align-top bottom-buffer-40">
            <li>
                <div id="share" class="article-share"></div>
            </li>
        </ul>
        <h2 class="sidebar-h2-align-top">Related</h2>
        <ul class="articles-related">
            {% for article in related_articles %}
            <li>
                <span class="articles-related__count {% if article.views > 100 %} highlighted {% endif %}">{{article.views}}</span>
                <a href="{% url 'articles:detail' slug=article.slug%}">{{ article.title }}</a>
            </li>
            {% endfor %}
        </ul>
    </div>
</div>

{% endblock %} {% block javascript %}

<script>
    app = new VueaApp({
        data: {
            rating: parseFloat('{{ article.rating }}'),
            my_rating: '{{ my_rating }}',
            show_rating: true,
            rating_feedback: 'How helpful was this answer for you ?'
        },
        mounted: function() {
            init(this);
        },
        methods: {

        }
    });

    function init(app) {
        //$('#article-body').flowtype();

        $('#articleRatings').barrating({
            theme: 'fontawesome-stars-o',
            initialRating: app.rating,
            readonly: true
        });

        $("#share").jsSocials({
            url: window.location.origin + '{{ article.link }}',
            text: "{{ artciel.title }}",
            showLabel: false,
            showCount: "inside",
            shares: ["email", "twitter", "facebook", "googleplus", "linkedin"]
        });

        $('#rateArticle').barrating({
            initialRating: app.my_rating,
            theme: 'fontawesome-stars-o',
            showSelectedRating: true,
            onSelect: function(value, text) {
                rateArticle(value);
            }
        });
    }

    function rateArticle(value) {
        var csrftoken = Cookies.get('csrftoken');
        axios({
                method: 'get',
                url: '/articles/api/{{ article.id }}/content/{{ article.active_content.id }}/rate',
                params: {
                    'v': value
                },
                headers: {
                    'X-CSRFToken': csrftoken
                }
            })
            .then(function(response) {
                app.rating = response.data.average;
                app.rating_feedback = "Thank you!";
                app.show_rating = false;
            })
            .catch(function(error) {
                console.log(error);
            });
    }
</script>

{% endblock %}