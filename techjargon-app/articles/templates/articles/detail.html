{% extends "_base.html" %}

{% load static %}

{% load article_meta_filter %}

{% block title %} {{article.title}} {% endblock %}

{% block content %}

<div class="row">
	<div class="col-sm-7 col-sm-offset-1">

		<div class="row">
			<small class="pull-right"><i class="fa fa-eye text-muted" aria-hidden="true"></i> {{ article.views }}</small>
		  <h1>{{ article.title|title }}</h1>
		</div>

		<div class="row">
			<p class="lead text-justify">{{ article.active_content.body | safe }}</p>
		</div>

		<div class="row">
			<span class="pull-right"><i class="fa fa-list" aria-hidden="true"></i></span>
			<table class="table table-condensed table-responsive">
				<tbody>
					{% for meta in article.active_content.contentmeta_set.all %}
					<tr>
						<td width="100">{{ meta.name }}</td>
	        			<td>{{ meta.data|article_meta|safe}}</td>
        			</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>

		<div class="row">
			{% for tag in article.tags.all %}
			<a class="tag" href="{% url 'articles:tags_detail' tag.slug %}">{{ tag.name }}</a>
			{% endfor %}
		</div>

		<div class="row">
			<span class="text-right">
				<p><small> <a href="{% url 'articles:history' slug=article.slug content_id=article.active_content.id %}">edited {{ article.active_content.created_at |  date:"d, N Y" }}</a></small><br>
				<a href="#">{{ article.active_content.author.user.first_name }} {{ article.active_content.author.user.last_name }}</a>
				</p>
			</span>
		</div>

		<div class="row article-info-panel">
			<a href="{% url 'articles:update' slug=article.slug article_id=article.id %}" class="">improve this article</a>
			<!-- <a href="#" class="show-pop-dropdown pull-right" data-placement="bottom" data-target="webuiPopover84">actions</a> -->
			<a role="presentation" class="dropdown">
				<a href="#" class="dropdown-toggle" id="drop5" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true"> more <span class="caret"></span> </a>
				<ul class="dropdown-menu " id="menu2" aria-labelledby="drop5">
					<li><a href="#">rate </a></li>
					<li><a href="#">share</a></li>
					<li><a href="{% url 'articles:history' slug=article.slug content_id=article.active_content.id %}">history </a></li>
					<li role="separator" class="divider"></li>
					<li><a href="#" class="text-danger">report <i class="fa fa-bullhorn pull-right text-danger" aria-hidden="true"></i></a></li>
				</ul>
			</a>

		</div>

	</div>

	<div class="col-sm-3">
			<div class="col-sm-10 col-sm-offset-2">
				<div class="row">
					<h3>Related Adrticles:</h3>
				</div>
				<div class="row">
					{% for article in related_articles %}
					<div class="related-articles">
						<a href="{% url 'articles:detail' slug=article.slug%}">
							<h4>
								{% if article.views > 100 %}
								<span class="view-count btn-success">{{article.views}}</span>
								{% else %}
								<span class="view-count view-count-gray">{{article.views}}</span>
								{% endif %}
								{{ article.title }}
							</h4>
						</a>
					</div>
					{% endfor %}
				</div>
			</div>
	</div>

	<div class="col-sm-2" style="display:none;">
		<div class="row">
			<h5 class="text-right">History</h5>
		</div>
		<div class="row" style="max-height: 400px; overflow: scroll;">
			{% for history in article.history_content.all %}
			<div class="col-sm-10 col-sm-offset-2 text-right">
				<span>
					<small>
					<a href="{% url 'articles:history' slug=article.slug content_id=history.id %}">{{ history.updated_at |  date:"d l, N Y" }}</a>
					</small>
				</span>
				<br>
				<span><small>Edit by <a href="#">{{ history.author.user.username }}</a></small></span>
				<hr>
			</div>
			{% endfor %}
		</div>
	</div>


</div>

{% endblock %}

{% block javascript %}
<script>
	$(document).ready(function() {
	  // $('a').webuiPopover();
		$('.dropdown-toggle').dropdown()
	});
</script>
{% endblock %}
