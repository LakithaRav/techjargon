{% extends "_base.html" %}

{% load static %}

{% load range_filter %}

{% block title %} #{{tag.name}} {% endblock %}

{% block meta %}
<meta name="article_keywords" content="{{ tag.name }}, tags, search">

<!-- Open Graph Protocol Meta -->
<meta property='og:title' content='{{ tag.name }}' />
<meta property='og:url' content='{{ full_url_path }}' />
<meta property='og:image' content='http://fidenz.com/wp-content/themes/one-page/images/fidenz.png' />
<meta property='og:image:url' content='http://fidenz.com/wp-content/themes/one-page/images/fidenz.png' />
<meta property='og:image:width' content='1200' />
<meta property='og:image:height' content='630' />
<meta property='og:image:type' content='image/jpeg' />
<meta property='og:description' content='{{ article.active_content.body }}' />
<!-- END Open Graph Protocol Meta -->
{% endblock %}

{% block content %}
<div class="row">
	<div class="col-sm-7 col-sm-offset-1">

    <div class="row">
			<div class="col-sm-12">
      	<h1 class="text-info"><u>#{{ tag.name }}</u></h1>
			</div>
    </div>
    <hr>

    <div class="col-sm-12">
      {% for article in articles %}
			<div class="box text-justify">
				<div class="row">
					<div class="col-md-12">
						<h4>
							{% if article.views > 100 %}
							<span class="view-count btn-success">{{article.views}}</span>
							{% else %}
							<span class="view-count view-count-gray">{{article.views}}</span>
							{% endif %}
							<a href="{{ article.link }}"><h3 class="text-capitalize">{{ article.title }}</h3></a>
						</h4>

						<span class="text-left text-muted">{{ article.description_short|safe }}</span>
					</div>
				</div>
				<br>
				<div class="row">
					<div class="col-md-12">
						{% for tag in article.tags.all %}
						<a class="tag" href="{% url 'articles:tags_detail' tag.slug %}">{{ tag.name }}</a>
						{% endfor %}
					</div>
				</div>
				<div class="row">
					<div class="col-md-12">
						<span class="text-right">
							<small>
								<p>
									<small> on {{ article.updated_at |  date:"d, N Y" }}</small><br>
									<a href="#">{{ article.active_content.author.user.first_name }} {{ article.active_content.author.user.last_name }}</a>
								</p>
							</small>
						</span>
					</div>
				</div>
			</div>
      <hr>
      {% endfor %}
    </div>

		<div class="col-sm-12">
			<nav aria-label="Page navigation">
			  <ul class="pagination">
					{% if articles.has_previous %}
					<li>
						<a href="?page={{ articles.previous_page_number }}" aria-label="Previous">
							<span aria-hidden="true">&laquo;</span>
						</a>
					</li>
	        {% endif %}

			    {% for page in 1|range:articles.paginator.num_pages %}
					<li><a href="?page={{ page }}">{{ page }}</a></li>
					{% endfor %}

					{% if articles.has_next %}
						<li>
						 <a href="?page={{ articles.next_page_number }}" aria-label="Next">
							 <span aria-hidden="true">&raquo;</span>
						 </a>
					 </li>
					 {% endif %}

			  </ul>
			</nav>
		</div>

  </div>

  <div class="col-sm-3">
    <div class="row">
      <h2 class="text-left">{{ hit_count }}</h2>
			{% if hit_count > 1 %}
      	<span>articles tagged</span>
			{% else %}
				<span>article tagged</span>
			{% endif %}
    </div>
    <br>

    <div class="row">
      <h4 class="text-left text-muted"><i class="fa fa-hashtag" aria-hidden="true"></i> Related</h4>
      <div class="text-justify">
        {% for tag in ralated_tags %}
        <a class="tag" href="{% url 'articles:tags_detail' tag.slug %}">{{ tag.name }} {{ tag.article_set.count }}</a>
        {% endfor %}
      </div>
    </div>
    <br>

    <div class="row">
      <h4 class="text-left text-muted"><i class="fa fa-folder-open" aria-hidden="true"></i> New</h4>
      <div class="text-justify">
        {% for article in new_articles %}
				<div class="related-articles">
					<a href="{% url 'articles:detail' slug=article.slug%}">
						<h4>
							{% if article.views > 100 %}
							<span class="view-count btn-success">{{article.views}}</span>
							{% else %}
							<span class="view-count view-count-gray">{{article.views}}</span>
							{% endif %}
							{{ article.title | title }}
						</h4>
					</a>
				</div>
        {% endfor %}
      </div>
    </div>

  </div>

</div>



{% endblock %}

{% block javascript %}

<script>
	$(document).ready(function() {
		mixpanel.track('tag', {name: "{{tag.name}}"});
	});
</script>
{% endblock %}
